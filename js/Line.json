{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "description": "National trends in population ageing and hospital capacity, 2001–2025.",
  "data": {
    "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/data/state_summary_all_years_ready_public_2001_2025.csv",
    "format": { "type": "csv" }
  },
  "width": 920,
  "height": 460,
  "title": {
    "text": "Temporal Trends in Population Ageing and Hospital Capacity in Australia, 2001–2024",
    "subtitle": "The share of residents aged 65 and over has increased steadily, whereas hospital capacity has expanded more slowly, indicating a growing imbalance between demand and supply.",
    "anchor": "start",
    "fontSize": 20,
    "subtitleFontSize": 13
  },
  "params": [
    {
      "name": "metric",
      "value": "count",
      "bind": {
        "input": "select",
        "name": "Hospital Capacity Metric: ",
        "options": ["count", "per100k65"],
        "labels": ["Public Hospitals (Total)", "Public Hospitals per 100,000 People Aged 65 and Over"]
      }
    }
  ],
  "transform": [
    { "calculate": "toNumber(datum.year)", "as": "year_num" },
    {
      "aggregate": [
        { "op": "sum", "field": "population_total", "as": "population_total" },
        { "op": "sum", "field": "population_65plus", "as": "population_65plus" },
        { "op": "sum", "field": "hospitals_count", "as": "hospitals_count" }
      ],
      "groupby": ["year_num"]
    },
    { "calculate": "datum.population_65plus / datum.population_total * 100", "as": "percent_65plus" },
    { "calculate": "datum.hospitals_count / (datum.population_65plus / 100000)", "as": "hospitals_per100k65" },
    { "calculate": "toDate(datum.year_num + '-01-01')", "as": "yearDate" }
  ],
  "layer": [
    {
      "mark": { "type": "line", "color": "#E76F51", "point": true, "strokeWidth": 3 },
      "encoding": {
        "x": { "field": "yearDate", "type": "temporal", "axis": { "title": "Year" } },
        "y": {
          "field": "percent_65plus",
          "type": "quantitative",
          "axis": { "title": "Population Aged 65 and Over (%)", "grid": true }
        },
        "tooltip": [
          { "field": "year_num", "title": "Year" },
          { "field": "percent_65plus", "title": "Aged 65+ (%)", "format": ".2f" }
        ]
      }
    },
    {
      "transform": [{ "filter": "metric == 'count'" }],
      "mark": { "type": "line", "color": "#264653", "point": true, "strokeDash": [6, 4], "strokeWidth": 2 },
      "encoding": {
        "x": { "field": "yearDate", "type": "temporal" },
        "y": {
          "field": "hospitals_count",
          "type": "quantitative",
          "scale": { "domain": [300, 800], "zero": false },
          "axis": { "orient": "right", "title": "Public Hospitals (Total)", "grid": false }
        },
        "tooltip": [
          { "field": "year_num", "title": "Year" },
          { "field": "hospitals_count", "title": "Public Hospitals (Total)", "format": ".0f" }
        ]
      }
    },
    {
      "transform": [{ "filter": "metric == 'per100k65'" }],
      "mark": { "type": "line", "color": "#264653", "point": true, "strokeDash": [6, 4], "strokeWidth": 2 },
      "encoding": {
        "x": { "field": "yearDate", "type": "temporal" },
        "y": {
          "field": "hospitals_per100k65",
          "type": "quantitative",
          "scale": { "zero": false },
          "axis": { "orient": "right", "title": "Public Hospitals per 100,000 People Aged 65 and Over", "grid": false }
        },
        "tooltip": [
          { "field": "year_num", "title": "Year" },
          { "field": "hospitals_per100k65", "title": "Hospitals per 100k (Aged 65+)", "format": ".2f" }
        ]
      }
    },
    {
      "data": {
        "values": [
          { "note": "Data Sources: Australian Institute of Health and Welfare (AIHW); Australian Bureau of Statistics (ABS), 2001–2025." }
        ]
      },
      "mark": { "type": "text", "align": "left", "baseline": "bottom", "dx": 8, "dy": -6, "fontSize": 11, "fill": "#6b7280" },
      "encoding": { "x": { "value": 0 }, "y": { "value": 510 }, "text": { "field": "note" } }
    }
  ],
  "resolve": { "scale": { "y": "independent" } },
  "config": {
    "axis": { "labelFontSize": 12, "titleFontSize": 12, "labelColor": "#333", "titleColor": "#333" },
    "view": { "stroke": null }
  }
}

