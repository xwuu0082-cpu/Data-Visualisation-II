{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/data/state_summary_all_years_ready_public_2001_2025.csv",
    "format": {"type": "csv"}
  },
  "params": [
    {
      "name": "Year",
      "value": 2024,
      "bind": {"input": "range", "min": 2001, "max": 2024, "step": 1}
    }
  ],
  "transform": [
    {
      "filter": "toNumber(datum.year) == Year && datum.state_name != 'Australia' && datum.state_name != 'Other Territories'"
    }
  ],
  "width": 760,
  "height": 480,
  "layer": [
    {
      "mark": {"type": "circle", "opacity": 0.9, "tooltip": true},
      "encoding": {
        "x": {
          "field": "percent_65plus",
          "type": "quantitative",
          "title": "Elderly population (65+) %",
          "scale": {"nice": true}
        },
        "y": {
          "field": "hospitals_per_100k",
          "type": "quantitative",
          "title": "Public hospitals per 100,000 residents",
          "scale": {"nice": true}
        },
        "size": {
          "field": "population_total",
          "type": "quantitative",
          "title": "Total population",
          "scale": {"range": [60, 1600]}
        },
        "color": {
          "field": "percent_65plus",
          "type": "quantitative",
          "title": "65+ %",
          "scale": {"scheme": "cividis"}
        },
        "tooltip": [
          {
            "field": "state_name",
            "type": "nominal",
            "title": "State/Territory"
          },
          {"field": "year", "type": "quantitative", "title": "Year"},
          {
            "field": "percent_65plus",
            "type": "quantitative",
            "title": "65+ %",
            "format": ".1f"
          },
          {
            "field": "hospitals_per_100k",
            "type": "quantitative",
            "title": "Hospitals /100k",
            "format": ".2f"
          },
          {
            "field": "hospitals_count",
            "type": "quantitative",
            "title": "Hospitals (total)"
          },
          {
            "field": "population_total",
            "type": "quantitative",
            "title": "Population (total)"
          }
        ]
      }
    },
    {
      "mark": {"type": "text", "dy": -10, "fontSize": 11},
      "encoding": {
        "x": {"field": "percent_65plus", "type": "quantitative"},
        "y": {"field": "hospitals_per_100k", "type": "quantitative"},
        "text": {"field": "abbr", "type": "nominal"},
        "color": {"value": "black"}
      }
    },
    {
      "transform": [
        {
          "aggregate": [
            {"op": "mean", "field": "hospitals_per_100k", "as": "yMean"}
          ]
        }
      ],
      "mark": {"type": "rule", "strokeDash": [6, 4], "opacity": 0.6},
      "encoding": {
        "y": {"field": "yMean", "type": "quantitative"},
        "size": {"value": 2},
        "color": {"value": "#555"}
      }
    },
    {
      "transform": [
        {
          "aggregate": [
            {"op": "mean", "field": "percent_65plus", "as": "xMean"}
          ]
        }
      ],
      "mark": {"type": "rule", "strokeDash": [6, 4], "opacity": 0.6},
      "encoding": {
        "x": {"field": "xMean", "type": "quantitative"},
        "size": {"value": 2},
        "color": {"value": "#555"}
      }
    },
    {
      "transform": [
        {
          "aggregate": [
            {"op": "mean", "field": "percent_65plus", "as": "xMean"},
            {"op": "mean", "field": "hospitals_per_100k", "as": "yMean"}
          ]
        }
      ],
      "mark": {"type": "point", "filled": true, "size": 220},
      "encoding": {
        "x": {"field": "xMean", "type": "quantitative"},
        "y": {"field": "yMean", "type": "quantitative"},
        "color": {"value": "black"},
        "tooltip": [
          {"value": "National average", "title": "Label"},
          {
            "field": "xMean",
            "type": "quantitative",
            "title": "65+ % (mean)",
            "format": ".2f"
          },
          {
            "field": "yMean",
            "type": "quantitative",
            "title": "Hospitals /100k (mean)",
            "format": ".2f"
          }
        ]
      }
    },
    {
      "transform": [
        {
          "aggregate": [
            {"op": "mean", "field": "percent_65plus", "as": "xMean"},
            {"op": "mean", "field": "hospitals_per_100k", "as": "yMean"}
          ]
        }
      ],
      "mark": {
        "type": "text",
        "dx": 8,
        "dy": -8,
        "fontSize": 12,
        "fontWeight": "bold"
      },
      "encoding": {
        "x": {"field": "xMean", "type": "quantitative"},
        "y": {"field": "yMean", "type": "quantitative"},
        "text": {"value": "National average"},
        "color": {"value": "black"}
      }
    }
  ],
  "title": {
    "text": "Public Hospitals vs Elderly Population by State (2001–2024)",
    "subtitle": "Each bubble represents a state or territory — bubble size shows total population"
  },
  "config": {
    "view": {"stroke": null},
    "background": "white",
    "axis": {"labelFontSize": 12, "titleFontSize": 13},
    "legend": {"labelFontSize": 12, "titleFontSize": 13}
  }
}
