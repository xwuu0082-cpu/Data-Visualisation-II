{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "title": {
    "text": "Where is Ageing Most Concentrated in Australia?",
    "subtitle": [
      "Older Australians are predominantly concentrated in southern and coastal states such as Tasmania and South Australia.",
      "Darker colour indicates a higher percentage of residents aged 65 years and over, while larger circles represent states with a greater number of public hospitals per one hundred thousand people."
    ],
    "anchor": "start",
    "fontSize": 20,
    "subtitleFontSize": 13
  },
  "width": 920,
  "height": 720,
  "projection": {"type": "mercator", "center": [134, -27], "scale": 900},
  "params": [
    {
      "name": "metric",
      "value": "total",
      "bind": {
        "input": "radio",
        "options": ["total", "per100k"],
        "labels": ["Hospitals (Total)", "Hospitals per 100,000 People"]
      }
    },
    {
      "name": "year_select",
      "value": 2024,
      "bind": {
        "input": "range",
        "min": 2001,
        "max": 2024,
        "step": 1,
        "name": "Select Year:"
      }
    }
  ],
  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/data/state_summary_all_years_ready_public_2001_2025.csv",
        "format": {
          "type": "csv",
          "parse": {
            "year": "number",
            "population_total": "number",
            "percent_65plus": "number",
            "hospitals_count": "number",
            "hospitals_per_100k": "number",
            "longitude": "number",
            "latitude": "number"
          }
        }
      },
      "transform": [
        {"filter": "datum.year == year_select"},
        {
          "lookup": "state_name",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/js/STE_2021_AUST_GDA2020.json",
              "format": {"type": "topojson", "feature": "STE_2021_AUST_GDA2020"}
            },
            "key": "properties.STE_NAME21",
            "fields": ["geometry"]
          },
          "as": ["geometry"]
        },
        {"filter": "datum.geometry != null"}
      ],
      "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 0.8},
      "encoding": {
        "shape": {"field": "geometry", "type": "geojson"},
        "color": {
          "field": "percent_65plus",
          "type": "quantitative",
          "title": "Percentage of Residents Aged 65 Years and Over",
          "scale": {"scheme": {"name": "cividis", "extent": [0.2, 1]}}
        },
        "tooltip": [
          {"field": "state_name", "title": "State or Territory"},
          {"field": "year", "title": "Year"},
          {"field": "population_total", "title": "Total Population", "format": ","},
          {"field": "hospitals_count", "title": "Total Number of Public Hospitals", "format": ","},
          {"field": "hospitals_per_100k", "title": "Public Hospitals per 100,000 People", "format": ".2f"},
          {"field": "percent_65plus", "title": "Percentage Aged 65 Years and Over", "format": ".1f"}
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/data/state_summary_all_years_ready_public_2001_2025.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        {"filter": "toNumber(datum.year) == year_select"},
        {
          "calculate": "metric == 'per100k' ? toNumber(datum.hospitals_per_100k) : toNumber(datum.hospitals_count)",
          "as": "metric_value_raw"
        },
        {
          "calculate": "isValid(datum.metric_value_raw) && isFinite(datum.metric_value_raw) ? datum.metric_value_raw : null",
          "as": "metric_value"
        },
        {"filter": "datum.metric_value != null"}
      ],
      "mark": {
        "type": "circle",
        "opacity": 0.85,
        "stroke": "#ffffff",
        "strokeWidth": 0.9
      },
      "encoding": {
        "longitude": {"field": "longitude", "type": "quantitative"},
        "latitude": {"field": "latitude", "type": "quantitative"},
        "size": {
          "field": "metric_value",
          "type": "quantitative",
          "scale": {"type": "sqrt", "range": [100, 1800], "domainMin": 0},
          "legend": {"title": "Hospital Metric"}
        },
        "color": {"value": "#0b2e6f"},
        "tooltip": [
          {"field": "state_name", "title": "State or Territory"},
          {"field": "year", "title": "Year"},
          {"field": "population_total", "title": "Total Population", "format": ","},
          {"field": "hospitals_count", "title": "Total Number of Public Hospitals", "format": ","},
          {"field": "hospitals_per_100k", "title": "Public Hospitals per 100,000 People", "format": ".2f"}
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/data/state_summary_all_years_ready_public_2001_2025.csv",
        "format": {"type": "csv"}
      },
      "transform": [{"filter": "toNumber(datum.year) == year_select"}],
      "mark": {
        "type": "text",
        "fontSize": 11,
        "fontWeight": "bold",
        "fill": "#ffffff",
        "stroke": "#0b2e6f",
        "strokeWidth": 0.5,
        "dy": -5
      },
      "encoding": {
        "longitude": {"field": "longitude"},
        "latitude": {"field": "latitude"},
        "text": {"field": "abbr"}
      }
    },
    {
      "data": {
        "values": [
          {
            "note": "Observation: Tasmania and South Australia have the highest proportions of elderly residents but comparatively fewer hospitals, indicating uneven preparedness across the healthcare system."
          }
        ]
      },
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "top",
        "dx": 8,
        "dy": 5,
        "fontSize": 12,
        "fill": "#374151"
      },
      "encoding": {
        "x": {"value": 0},
        "y": {"value": 705},
        "text": {"field": "note"}
      }
    },
    {
      "data": {
        "values": [
          {
            "note": "Data Sources: Australian Institute of Health and Welfare (AIHW) and Australian Bureau of Statistics (ABS), 2001â€“2025."
          }
        ]
      },
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "bottom",
        "dx": 8,
        "dy": -6,
        "fontSize": 11,
        "fill": "#6b7280"
      },
      "encoding": {
        "x": {"value": 0},
        "y": {"value": 700},
        "text": {"field": "note"}
      }
    }
  ],
  "config": {
    "legend": {
      "orient": "bottom",
      "labelFontSize": 12,
      "titleFontSize": 12,
      "titleLimit": 0,
      "padding": 10
    },
    "view": {"stroke": null},
    "axis": {"labelFontSize": 12, "titleFontSize": 12}
  }
}
