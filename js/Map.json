{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "title": {
    "text": "Spatial Concentration of Population Ageing in Australia",
    "subtitle": [
      "Older populations are concentrated in southern and coastal jurisdictions, notably Tasmania and South Australia.",
      "Darker shading indicates a higher percentage of residents aged 65 and over; larger circles indicate more public hospitals per 100,000 people."
    ],
    "anchor": "start",
    "fontSize": 20,
    "subtitleFontSize": 13
  },
  "width": 920,
  "height": 620,
  "projection": { "type": "mercator", "center": [134, -27], "scale": 900 },
  "params": [
    {
      "name": "metric",
      "value": "per100k",
      "bind": {
        "input": "radio",
        "options": ["total", "per100k"],
        "labels": ["Public Hospitals (Total)", "Public Hospitals per 100,000 Residents"]
      }
    },
    {
      "name": "year_select",
      "value": 2024,
      "bind": { "input": "range", "min": 2001, "max": 2024, "step": 1, "name": "Select Year:" }
    }
  ],
  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/data/state_summary_all_years_ready_public_2001_2025.csv",
        "format": {
          "type": "csv",
          "parse": {
            "year": "number",
            "population_total": "number",
            "percent_65plus": "number",
            "hospitals_count": "number",
            "hospitals_per_100k": "number",
            "longitude": "number",
            "latitude": "number"
          }
        }
      },
      "transform": [
        { "filter": "datum.year == year_select" },
        {
          "lookup": "state_name",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/js/STE_2021_AUST_GDA2020.json",
              "format": { "type": "topojson", "feature": "STE_2021_AUST_GDA2020" }
            },
            "key": "properties.STE_NAME21",
            "fields": ["geometry"]
          },
          "as": ["geometry"]
        },
        { "filter": "datum.geometry != null" }
      ],
      "mark": { "type": "geoshape", "stroke": "#ffffff", "strokeWidth": 0.8 },
      "encoding": {
        "shape": { "field": "geometry", "type": "geojson" },
        "color": {
          "field": "percent_65plus",
          "type": "quantitative",
          "title": "Percentage of Residents Aged 65 and Over",
          "scale": { "scheme": { "name": "cividis", "extent": [0.25, 1] } },
          "legend": {
            "orient": "bottom",
            "gradientLength": 500,
            "titleLimit": 1000,
            "labelLimit": 1000
          }
        },
        "tooltip": [
          { "field": "state_name", "title": "State/Territory" },
          { "field": "year", "title": "Year" },
          { "field": "population_total", "title": "Population", "format": "," },
          { "field": "hospitals_count", "title": "Public Hospitals (Total)", "format": "," },
          { "field": "hospitals_per_100k", "title": "Public Hospitals per 100,000 Residents", "format": ".2f" },
          { "field": "percent_65plus", "title": "Aged 65+ (%)", "format": ".1f" }
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/data/state_summary_all_years_ready_public_2001_2025.csv",
        "format": { "type": "csv" }
      },
      "transform": [
        { "filter": "toNumber(datum.year) == year_select" },
        {
          "calculate": "metric == 'per100k' ? toNumber(datum.hospitals_per_100k) : toNumber(datum.hospitals_count)",
          "as": "metric_value"
        },
        { "filter": "isValid(datum.metric_value) && isFinite(datum.metric_value)" }
      ],
      "mark": { "type": "circle", "opacity": 0.85, "stroke": "#ffffff", "strokeWidth": 0.9 },
      "encoding": {
        "longitude": { "field": "longitude", "type": "quantitative" },
        "latitude": { "field": "latitude", "type": "quantitative" },
        "size": {
          "field": "metric_value",
          "type": "quantitative",
          "scale": { "type": "sqrt", "range": [100, 1800], "domainMin": 0 },
          "legend": { "title": "Hospital Capacity Metric" }
        },
        "color": { "value": "#264653" },
        "tooltip": [
          { "field": "state_name", "title": "State/Territory" },
          { "field": "year", "title": "Year" },
          { "field": "population_total", "title": "Population", "format": "," },
          { "field": "hospitals_count", "title": "Public Hospitals (Total)", "format": "," },
          { "field": "hospitals_per_100k", "title": "Public Hospitals per 100,000 Residents", "format": ".2f" }
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/xwuu0082-cpu/Data-Visualisation-II/refs/heads/main/data/state_summary_all_years_ready_public_2001_2025.csv",
        "format": { "type": "csv" }
      },
      "transform": [{ "filter": "toNumber(datum.year) == year_select" }],
      "mark": {
        "type": "text",
        "fontSize": 11,
        "fontWeight": "bold",
        "fill": "#ffffff",
        "stroke": "#264653",
        "strokeWidth": 0.5,
        "dy": -5
      },
      "encoding": {
        "longitude": { "field": "longitude" },
        "latitude": { "field": "latitude" },
        "text": { "field": "abbr" }
      }
    },
    {
      "data": {
        "values": [
          {
            "note": "Data Sources: Australian Institute of Health and Welfare (AIHW); Australian Bureau of Statistics (ABS), 2001â€“2025."
          }
        ]
      },
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "bottom",
        "dx": 8,
        "dy": -6,
        "fontSize": 11,
        "fill": "#6b7280"
      },
      "encoding": { "x": { "value": 0 }, "y": { "value": 640 }, "text": { "field": "note" } }
    }
  ],
  "config": {
    "legend": { "orient": "bottom" },
    "view": { "stroke": null },
    "axis": { "labelFontSize": 12, "titleFontSize": 12 }
  }
}
